
# Fibonacci API

**Fibonacci API** – это высокопроизводительное API для вычисления чисел Фибоначчи с учётом конкурентных запросов и кэширования.

---

## Основные возможности
- Получение числа Фибоначчи по индексу `n`.
- Генерация последовательности чисел Фибоначчи до индекса `n`.
- Кэширование результатов для повышения производительности.
- Конкурентная обработка запросов.
- Ограничение на максимальный индекс `n`, задаваемое через конфигурацию.
- Мониторинг производительности через Prometheus.

---


# Описание эндпоинтов API с учётом кода

## Эндпоинты gRPC API

### 1. Получение числа Фибоначчи

**gRPC метод:** `GetFibonacciNumber`

Возвращает число Фибоначчи для заданного индекса `n`.  
Если индекс превышает максимально допустимый (`MaxFibonacciN` из конфигурации), сервер возвращает ошибку.

#### Пример запроса:
```json
{
  "index": 10
}
```

#### Пример ответа (для index ≤ 92):
```json
{
   "int_value": 55
}
```

#### Пример ответа (для index > 92):
```json
{
  
 "bigValue": "354224848179261915075"
  
}
```

---

### 2. Генерация последовательности чисел Фибоначчи

**gRPC метод:** `GetFibonacciSequence`

Возвращает последовательность чисел Фибоначчи от 0 до заданного индекса `maxIndex`.  
Если `maxIndex` превышает допустимый (`MaxFibonacciN`), сервер возвращает ошибку.

#### Пример запроса:
```json
{
  "maxIndex": 5
}
```

#### Пример ответа:
```json
{
  "sequence": ["0", "1", "1", "2", "3", "5"]
}
```

#### Коды ошибок:
- `InvalidArgument (400)` – индекс меньше 1 или больше допустимого.
- `ResourceExhausted (429)` – превышен лимит запросов.
- `DeadlineExceeded (408)` – превышено время обработки запроса.
- `Internal (500)` – ошибка вычисления.
--------

## Установка и запуск

### 1. С помощью Docker
Убедитесь, что у вас установлены Docker и docker-compose.

**Шаги:**
1. Клонируйте репозиторий:
   ```bash
   git clone 
   cd fibonacci-api
   ```
2. Запустите контейнеры:
   ```bash
   docker-compose up --build
   ```

---

## Конфигурация

Файл конфигурации находится в `configs/config.yaml` и поддерживает следующие параметры:
- `max_fibonacci_n`: Максимальный индекс числа Фибоначчи.
- `grpc_port`: Порт, на котором запускается API.
- `grpc_timeout`: Таймаут для вычислений в секундах.
- `redis_addr`: Адрес сервера Redis.
- `cache_expiration`: Время существования кэша.
- `local_cache_size`: Размер локального кэша.
- `log_level`: Минимальный уровень логирования.
- `log_output`: Выбор выхода логирования.
- `max_tokens`: Максимальное количество запросов за refill_rate.
- `refill_rate`: Скорость обновления max_tokens.
- `prometheus_addr`: Порт сервера для сбора метрик prometheus.

### Пример config.yaml:
```yaml
grpc_port: ":50051"
redis_addr: "redis:6379"
prometheus_addr: "9091"
max_fibonacci_n: 100000000
cache_expiration: 30s
local_cache_size: 10000
log_level: "debug"
log_output: "console"
max_tokens: 1
refill_rate: 1000000000
grpc_timeout: 15s
```

---

## Тестирование

Для запуска тестов выполните:
```bash
go test ./...
```

---

## Метрики

API собирает метрики с помощью Prometheus. После запуска Prometheus метрики будут доступны по адресу:
```
http://localhost:9090/metrics
```

### Ключевые метрики:
- `request_count_total`: Общее количество запросов.
- `request_duration_seconds`: Время обработки запросов.
- `error_count_total`: Общее количество ошибок.

---

